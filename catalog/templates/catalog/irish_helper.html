{% load static %}
{% load i18n %}
<!doctype html>
<html lang="{{ locale }}">
<head>
  <meta charset="utf-8">
  <title>{% trans "IrishHelper ‚Äî Guia para imigrantes na Irlanda" %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">

<!-- HEADER -->
<header class="sticky top-0 bg-white/90 backdrop-blur border-b z-20">

  <!-- LINHA 1 (T√≠tulo + idioma) -->
  <div class="max-w-4xl mx-auto px-3 sm:px-4 pt-2 pb-1 flex items-center justify-between">

    <!-- ESQUERDA: bandeira + t√≠tulo -->
    <div class="flex items-center gap-2 min-w-0">
      <span class="text-lg">üáÆüá™</span>
      <h1 class="text-base sm:text-lg md:text-xl font-semibold leading-tight truncate">
        {% trans "IrishHelper ‚Äî Guia R√°pido da Irlanda" %}
      </h1>
    </div>

    <!-- DIREITA: seletor de idioma + Go -->
    <div class="flex items-center gap-2">
      <select id="locale" class="border rounded px-2 py-1 text-xs sm:text-sm">
        <option value="pt-br" {% if locale == "pt-br" %}selected{% endif %}>Portugu√™s</option>
        <option value="en"    {% if locale == "en" %}selected{% endif %}>English</option>
        <option value="es"    {% if locale == "es" %}selected{% endif %}>Espa√±ol</option>
      </select>

      <button type="button"
              id="goLC"
              class="border px-3 py-1 rounded text-xs sm:text-sm hidden sm:inline-block">
        {% trans "Ir" %}
      </button>
    </div>
  </div>

  <!-- LINHA 2 (sandu√≠che no mobile + menu desktop) -->
  <div class="max-w-4xl mx-auto px-3 sm:px-4 pb-2 flex items-center justify-between">

    <!-- BOT√ÉO SANDU√çCHE NA ESQUERDA (somente mobile) -->
    <button id="mobileMenuBtn"
            class="md:hidden text-xl px-3 py-1 border rounded">
      ‚ò∞
    </button>

    <!-- MENU DESKTOP (√† direita, s√≥ md+) -->
    <nav class="hidden md:flex gap-x-4 text-sm">
      <a href="#uteis" class="hover:underline">{% trans "Links √∫teis" %}</a>
      <a href="#como" class="hover:underline">{% trans "Como solicitar" %}</a>
      <a href="#telefones" class="hover:underline">{% trans "Telefones" %}</a>
      <a href="#enderecos" class="hover:underline">{% trans "Endere√ßos" %}</a>
      <a href="#whatsapp" class="hover:underline">{% trans "WhatsApp" %}</a>
      <a href="#jobs" class="hover:underline">{% trans "Empregos" %}</a>
      <a href="#apps" class="hover:underline">{% trans "Apps √∫teis" %}</a>
      <a href="#videos" class="hover:underline">{% trans "V√≠deos" %}</a>
    </nav>
  </div>
</header>


  <!-- MENU MOBILE (drawer superior) -->
  <div id="mobileMenu" class="fixed inset-0 z-30 hidden md:hidden">
    <!-- fundo escurecido -->
    <div id="mobileMenuOverlay" class="absolute inset-0 bg-black/40"></div>

    <!-- painel principal -->
    <div class="absolute top-0 left-0 right-0 bg-white rounded-b-2xl shadow-lg p-4 pb-5">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-2">
          <span class="text-lg">üáÆüá™</span>
          <span class="font-semibold text-sm">
            {% trans "IrishHelper ‚Äî Guia R√°pido da Irlanda" %}
          </span>
        </div>
        <button id="mobileMenuClose" class="text-lg px-2 py-1">
          ‚úï
        </button>
      </div>

      <!-- navega√ß√£o em coluna -->
      <nav class="flex flex-col gap-2 text-sm">
        <a href="#uteis" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "Links √∫teis" %}
        </a>
        <a href="#como" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "Como solicitar" %}
        </a>
        <a href="#telefones" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "Telefones" %}
        </a>
        <a href="#enderecos" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "Endere√ßos" %}
        </a>
        <a href="#whatsapp" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "WhatsApp" %}
        </a>
        <a href="#jobs" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "Empregos" %}
        </a>
        <a href="#apps" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "Apps √∫teis" %}
        </a>
        <a href="#videos" data-mobile-nav-link class="py-1 hover:bg-gray-50 rounded px-1">
          {% trans "V√≠deos" %}
        </a>
      </nav>

      <!-- bot√£o Go dentro do menu -->
      <div class="mt-4 flex justify-end">
        <button
          type="button"
          id="goLCMobile"
          class="border px-3 py-1 rounded text-xs sm:text-sm">
          {% trans "Ir" %}
        </button>
      </div>
    </div>
  </div>

  <!-- CONTE√öDO -->
  <main class="max-w-4xl mx-auto px-3 sm:px-4 py-6 md:py-8 space-y-6 md:space-y-10">

    {% if ads.hero %}
    <section class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
      {% for ad in ads.hero %}
        {% if ad.html_embed %}
          <div class="mb-4">{{ ad.html_embed|safe }}</div>
        {% else %}
          <a target="_blank" href="{{ ad.target_url }}" class="block">
            {% if ad.image_url %}
              <img src="{{ ad.image_url }}" alt="{{ ad.title }}" class="rounded mb-2 w-full">
            {% endif %}
            {% if ad.title %}
              <p class="text-sm text-gray-600">{{ ad.title }}</p>
            {% endif %}
          </a>
        {% endif %}
      {% endfor %}
    </section>
    {% endif %}

    <!-- HERO -->
    <section class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
      <h2 class="text-xl md:text-2xl font-bold">
        {% trans "Tudo em um s√≥ lugar" %}
      </h2>
      <p class="mt-2 text-sm md:text-base text-gray-600">
        {% trans "Imigra√ß√£o (GNIB), PPS, Leap Card, Carteira de motorista (NDLS) e mais ‚Äî links oficiais, passo a passo, telefones e endere√ßos." %}
      </p>
      <p class="text-xs md:text-sm text-gray-500 mt-2">
        {% blocktrans %}Idioma: {{ locale }} | Pa√≠s: {{ country }}{% endblocktrans %}
      </p>
    </section>

    <!-- LINKS √öTEIS -->
    <section id="uteis" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm scroll-mt-24">
      <h3 class="text-lg md:text-xl font-bold">{% trans "Links √∫teis" %}</h3>
      <ul class="mt-4 grid gap-3">
        {% for r in useful_links %}
        <li class="p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition">
          <div class="flex items-center justify-between gap-3">
            <div class="min-w-0">
              <p class="font-medium text-sm md:text-base">
                {{ r.title }}
                {% if r.is_official %}
                  <span class="text-[10px] md:text-xs px-2 py-0.5 border rounded ml-2">
                    {% trans "Oficial" %}
                  </span>
                {% endif %}
              </p>
              {% if r.description %}
                <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
              {% endif %}
            </div>
            {% if r.url %}
              <a href="{{ r.url }}"
                 data-track="1"
                 data-link-id="{{ r.id }}"
                 data-href="{{ r.url }}"
                 class="shrink-0 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
                {% trans "Acessar" %}
              </a>
            {% endif %}
          </div>
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "Sem itens ainda." %}</p>
        {% endfor %}
      </ul>
    </section>

    <!-- COMO SOLICITAR -->
    <section id="como" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm scroll-mt-24">
      <h3 class="text-lg md:text-xl font-bold">{% trans "Como e onde solicitar" %}</h3>
      <div class="mt-4 space-y-3 md:space-y-4">
        {% for r in how_to %}
        <article class="p-3 md:p-4 border rounded-lg">
          <h4 class="font-semibold text-sm md:text-base">{{ r.title }}</h4>
          {% if r.description %}
            <p class="text-xs md:text-sm text-gray-600 mt-1 whitespace-pre-line">
              {{ r.description }}
            </p>
          {% endif %}
          {% if r.url %}
            <a href="{{ r.url }}"
               data-track="1"
               data-link-id="{{ r.id }}"
               data-href="{{ r.url }}"
               class="mt-2 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
              {% trans "Mais detalhes" %}
            </a>
          {% endif %}
        </article>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "Sem guias ainda." %}</p>
        {% endfor %}
      </div>
    </section>

    <!-- TELEFONES -->
    <section id="telefones" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm scroll-mt-24">
      <h3 class="text-lg md:text-xl font-bold">{% trans "Telefones √∫teis" %}</h3>
      <ul class="mt-3 grid gap-3 text-sm">
        {% for r in phones %}
        <li class="p-3 md:p-4 border rounded-lg">
          <p class="font-medium text-sm md:text-base">{{ r.title }}</p>
          {% if r.phone %}
            <a href="tel:{{ r.phone }}" class="text-xs md:text-sm text-blue-700 hover:underline block">
              {{ r.phone }}
            </a>
          {% endif %}
          {% if r.description %}
            <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
          {% endif %}
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "Sem telefones." %}</p>
        {% endfor %}
      </ul>
    </section>

    <!-- ENDERE√áOS -->
    <section id="enderecos" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm scroll-mt-24">
      <h3 class="text-lg md:text-xl font-bold">{% trans "Endere√ßos" %}</h3>
      <ul class="mt-3 grid gap-3 text-sm">
        {% for r in addresses %}
        <li class="p-3 md:p-4 border rounded-lg">
          <p class="font-medium text-sm md:text-base">{{ r.title }}</p>
          {% if r.address %}
            <p class="text-xs md:text-sm mt-0.5">{{ r.address }}</p>
          {% endif %}
          {% if r.url %}
            <a href="{{ r.url }}"
               data-track="1"
               data-link-id="{{ r.id }}"
               data-href="{{ r.url }}"
               class="mt-1 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
              {% trans "Abrir no mapa" %}
            </a>
          {% endif %}
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "Sem endere√ßos." %}</p>
        {% endfor %}
      </ul>
    </section>

    <!-- WHATSAPP (ACOMODA√á√ÉO) -->
    <section id="whatsapp" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm scroll-mt-24">
      <h3 class="text-lg md:text-xl font-bold">
        {% trans "Grupos de WhatsApp (acomoda√ß√£o)" %}
      </h3>
      <p class="text-xs md:text-sm text-gray-500 mt-1">
        {% trans "Grupos para vagas de quarto, casa e acomoda√ß√£o na Irlanda." %}
      </p>
      <ul class="mt-4 grid gap-3">
        {% for r in whatsapp_groups %}
        <li class="p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition">
          <div class="flex items-center justify-between gap-3">
            <div class="min-w-0">
              <p class="font-medium text-sm md:text-base">
                üí¨ {{ r.title }}
              </p>
              {% if r.description %}
                <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
              {% endif %}
            </div>
            {% if r.url %}
              <a href="{{ r.url }}"
                 data-track="1"
                 data-link-id="{{ r.id }}"
                 data-href="{{ r.url }}"
                 class="shrink-0 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
                {% trans "Entrar no grupo" %}
              </a>
            {% endif %}
          </div>
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">
            {% trans "Ainda n√£o h√° grupos cadastrados." %}
          </p>
        {% endfor %}
      </ul>
    </section>

    <!-- EMPREGOS: SITES + FACEBOOK -->
    <section id="jobs" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm space-y-6 scroll-mt-24">
      <h3 class="text-lg md:text-xl font-bold">
        {% trans "Empregos na Irlanda" %}
      </h3>

      <!-- SITES DE EMPREGO -->
      <div>
        <h4 class="font-semibold text-sm md:text-base">
          {% trans "Sites de emprego" %}
        </h4>
        <ul class="mt-3 grid gap-3">
          {% for r in job_sites %}
          <li class="p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition">
            <div class="flex items-center justify-between gap-3">
              <div class="min-w-0">
                <p class="font-medium text-sm md:text-base">{{ r.title }}</p>
                {% if r.description %}
                  <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
                {% endif %}
              </div>
              {% if r.url %}
                <a href="{{ r.url }}"
                   data-track="1"
                   data-link-id="{{ r.id }}"
                   data-href="{{ r.url }}"
                   class="shrink-0 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
                  {% trans "Visitar site" %}
                </a>
              {% endif %}
            </div>
          </li>
          {% empty %}
            <p class="text-sm text-gray-500">
              {% trans "Sem sites cadastrados." %}
            </p>
          {% endfor %}
        </ul>
      </div>

      <!-- GRUPOS DE EMPREGO (FACEBOOK) -->
      <div>
        <h4 class="font-semibold text-sm md:text-base">
          {% trans "Grupos de emprego (Facebook)" %}
        </h4>
        <ul class="mt-3 grid gap-3">
          {% for r in job_facebook %}
          <li class="p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition">
            <div class="flex items-center justify-between gap-3">
              <div class="min-w-0">
                <p class="font-medium text-sm md:text-base">üìò {{ r.title }}</p>
                {% if r.description %}
                  <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
                {% endif %}
              </div>
              {% if r.url %}
                <a href="{{ r.url }}"
                   data-track="1"
                   data-link-id="{{ r.id }}"
                   data-href="{{ r.url }}"
                   class="shrink-0 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
                  {% trans "Abrir grupo" %}
                </a>
              {% endif %}
            </div>
          </li>
          {% empty %}
            <p class="text-sm text-gray-500">
              {% trans "Sem grupos de emprego cadastrados." %}
            </p>
          {% endfor %}
        </ul>
      </div>
    </section>

    <!-- APPS E SERVI√áOS √öTEIS -->
    <section id="apps" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm scroll-mt-24">
      <h3 class="text-lg md:text-xl font-bold">
        {% trans "Apps e servi√ßos √∫teis" %}
      </h3>
      <p class="text-xs md:text-sm text-gray-500 mt-1">
        {% trans "Aplicativos e servi√ßos que facilitam o dia a dia na Irlanda." %}
      </p>
      <ul class="mt-4 grid gap-3">
        {% for r in daily_apps %}
        <li class="p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition">
          <div class="flex items-center justify-between gap-3">
            <div class="min-w-0">
              <p class="font-medium text-sm md:text-base">{{ r.title }}</p>
              {% if r.description %}
                <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
              {% endif %}
            </div>
            {% if r.url %}
              <a href="{{ r.url }}"
                 data-track="1"
                 data-link-id="{{ r.id }}"
                 data-href="{{ r.url }}"
                 class="shrink-0 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
                {% trans "Abrir app/site" %}
              </a>
            {% endif %}
          </div>
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">
            {% trans "Sem apps cadastrados." %}
          </p>
        {% endfor %}
      </ul>
    </section>

    <!-- V√çDEOS -->
    <section id="videos" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm scroll-mt-24">
      <h3 class="text-lg md:text-xl font-bold">{% trans "V√≠deos recomendados" %}</h3>
      <div class="mt-3 grid gap-3 sm:grid-cols-2">
        {% for r in videos %}
        <a class="block p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition"
           target="_blank" href="{{ r.url }}">
          <p class="font-medium text-sm md:text-base">{{ r.title }}</p>
          {% if r.description %}
            <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
          {% endif %}
        </a>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "Sem v√≠deos." %}</p>
        {% endfor %}
      </div>
    </section>

  </main>

  {% if ads.footer %}
  <footer class="max-w-4xl mx-auto px-3 sm:px-4 py-8 text-sm text-gray-500">
    <div class="grid sm:grid-cols-2 gap-4">
      {% for ad in ads.footer %}
      <div class="p-3 md:p-4 border rounded-lg">
        {% if ad.html_embed %}
          {{ ad.html_embed|safe }}
        {% else %}
          <a target="_blank" href="{{ ad.target_url }}">
            {% if ad.image_url %}
              <img src="{{ ad.image_url }}" alt="{{ ad.title }}" class="rounded mb-2 w-full">
            {% endif %}
            {% if ad.title %}
              <p>{{ ad.title }}</p>
            {% endif %}
          </a>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </footer>
  {% endif %}

  <p class="max-w-4xl mx-auto px-3 sm:px-4 pb-6 text-[11px] md:text-xs text-gray-500 text-center">
    {% trans "Feito com ‚ù§Ô∏è para a comunidade de imigrantes na Irlanda." %}
  </p>

  <!-- TRACKING DE CLIQUES -->
  <script>
    document.addEventListener("click", async (e) => {
      const a = e.target.closest('a[data-track="1"]');
      if (!a) return;
      e.preventDefault();
      const linkId = a.getAttribute("data-link-id");
      const href = a.getAttribute("data-href");
      const locale = "{{ locale }}";
      const country = "{{ country }}";
      try {
        await fetch(`/track/click/${linkId}/`, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ locale, country })
        });
      } catch (err) {
        console.warn("tracking falhou", err);
      }
      window.open(href, "_blank");
    });
  </script>

  <!-- BOT√ïES DE IDIOMA (desktop + mobile) -->
  <script>
    function goToLocale() {
      const loc = document.getElementById("locale").value;
      const url = `/${loc}/IE/`;
      window.location.href = url;
    }

    const goLC = document.getElementById("goLC");
    if (goLC) {
      goLC.addEventListener("click", goToLocale);
    }

    const goLCMobile = document.getElementById("goLCMobile");
    if (goLCMobile) {
      goLCMobile.addEventListener("click", goToLocale);
    }
  </script>

  <!-- MENU MOBILE JS -->
  <script>
    const mobileMenuBtn = document.getElementById("mobileMenuBtn");
    const mobileMenu    = document.getElementById("mobileMenu");
    const mobileClose   = document.getElementById("mobileMenuClose");
    const mobileOverlay = document.getElementById("mobileMenuOverlay");

    function closeMobileMenu() {
      mobileMenu.classList.add("hidden");
    }
    function openMobileMenu() {
      mobileMenu.classList.remove("hidden");
    }

    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener("click", () => {
        if (mobileMenu.classList.contains("hidden")) {
          openMobileMenu();
        } else {
          closeMobileMenu();
        }
      });
    }
    if (mobileClose) {
      mobileClose.addEventListener("click", closeMobileMenu);
    }
    if (mobileOverlay) {
      mobileOverlay.addEventListener("click", closeMobileMenu);
    }

    // fecha o menu ao clicar em um link interno
    document.querySelectorAll("[data-mobile-nav-link]").forEach((el) => {
      el.addEventListener("click", closeMobileMenu);
    });
  </script>
</body>
</html>
