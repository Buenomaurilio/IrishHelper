{% load static %}
{% load i18n %}
<!doctype html>
<html lang="{{ locale }}">
<head>
  <meta charset="utf-8">
  <title>{% trans "IrishHelper ‚Äî Guia para imigrantes na Irlanda" %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Deixar o layout ~85% do tamanho original no mobile -->
  <style>
    /* at√© 640px (sm do Tailwind) */
    @media (max-width: 640px) {
      html {
        font-size: 14px; /* padr√£o √© 16px ‚Üí 14px ‚âà 87,5% (bem perto do teu 85%) */
      }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- HEADER -->
  <header class="sticky top-0 bg-white/90 backdrop-blur border-b z-20">
    <!-- Linha principal: bandeira + t√≠tulo + idioma -->
    <div class="max-w-4xl mx-auto px-3 sm:px-4 py-2.5 flex items-center justify-between gap-2">

      <!-- ESQUERDA: bandeira + t√≠tulo -->
      <div class="flex items-center gap-2 min-w-0">
        <span class="text-lg">üáÆüá™</span>
        <h1 class="text-[15px] sm:text-base md:text-lg font-semibold leading-tight truncate">
          {% trans "IrishHelper ‚Äî Quick Guide to Ireland" %}
        </h1>
      </div>

      <!-- DIREITA: seletor de idioma (sempre vis√≠vel) -->
      <div class="flex items-center gap-2 md:gap-3">
        <select id="locale"
                class="border rounded px-2 py-1 text-[11px] sm:text-xs md:text-sm">
          <option value="pt-br" {% if locale == "pt-br" %}selected{% endif %}>Portugu√™s</option>
          <option value="en"    {% if locale == "en" %}selected{% endif %}>English</option>
          <option value="es"    {% if locale == "es" %}selected{% endif %}>Espa√±ol</option>
        </select>
      </div>
    </div>

    <!-- LINHA 2: bot√£o sandu√≠che (mobile) + menu desktop -->
    <div class="max-w-4xl mx-auto px-3 sm:px-4 pb-2 flex items-center justify-between md:justify-start gap-2">
      <!-- BOT√ÉO SANDU√çCHE (s√≥ mobile) -->
      <button id="mobileMenuBtn"
              class="md:hidden text-xl px-3 py-2 border rounded">
        ‚ò∞
      </button>

      <!-- MENU DESKTOP (fica logo ao lado, s√≥ md+) -->
      <nav class="hidden md:flex flex-wrap gap-x-4 gap-y-1 text-sm">
        <a href="#uteis" class="hover:underline">{% trans "Useful links" %}</a>
        <a href="#como" class="hover:underline">{% trans "How to apply" %}</a>
        <a href="#telefones" class="hover:underline">{% trans "Phone numbers" %}</a>
        <a href="#enderecos" class="hover:underline">{% trans "Addresses" %}</a>
        <a href="#whatsapp" class="hover:underline">{% trans "WhatsApp" %}</a>
        <a href="#jobs" class="hover:underline">{% trans "Jobs" %}</a>
        <a href="#apps" class="hover:underline">{% trans "Useful apps" %}</a>
        <a href="#videos" class="hover:underline">{% trans "Videos" %}</a>
      </nav>
    </div>
  </header>

  <!-- MENU MOBILE (DRAWER) -->
  <div id="mobileMenu" class="fixed inset-0 z-30 hidden md:hidden">
    <!-- fundo escurecido -->
    <div id="mobileMenuOverlay" class="absolute inset-0 bg-black/40"></div>

    <!-- painel principal -->
    <div class="absolute top-0 left-0 right-0 bg-white rounded-b-2xl shadow-lg p-4 pb-5">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-2">
          <span class="text-lg">üáÆüá™</span>
          <span class="font-semibold text-sm">
            {% trans "IrishHelper ‚Äî Quick Guide to Ireland" %}
          </span>
        </div>
        <button id="mobileMenuClose" class="text-lg px-2 py-1">
          ‚úï
        </button>
      </div>

      <!-- mesma navega√ß√£o, em coluna -->
      <nav class="flex flex-col gap-2 text-sm">
        <a href="#uteis" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "Useful links" %}
        </a>
        <a href="#como" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "How to apply" %}
        </a>
        <a href="#telefones" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "Phone numbers" %}
        </a>
        <a href="#enderecos" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "Addresses" %}
        </a>
        <a href="#whatsapp" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "WhatsApp" %}
        </a>
        <a href="#jobs" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "Jobs" %}
        </a>
        <a href="#apps" data-mobile-nav-link class="py-1 border-b border-gray-100 hover:bg-gray-50 rounded px-1">
          {% trans "Useful apps" %}
        </a>
        <a href="#videos" data-mobile-nav-link class="py-1 hover:bg-gray-50 rounded px-1">
          {% trans "Videos" %}
        </a>
      </nav>
    </div>
  </div>

  <!-- CONTE√öDO -->
  <main class="max-w-4xl mx-auto px-3 sm:px-4 py-6 md:py-8 space-y-6 md:space-y-10">

    {% if ads.hero %}
    <section class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
      {% for ad in ads.hero %}
        {% if ad.html_embed %}
          <div class="mb-4">{{ ad.html_embed|safe }}</div>
        {% else %}
          <a target="_blank" href="{{ ad.target_url }}" class="block">
            {% if ad.image_url %}
              <img src="{{ ad.image_url }}" alt="{{ ad.title }}" class="rounded mb-2 w-full">
            {% endif %}
            {% if ad.title %}
              <p class="text-sm text-gray-600">{{ ad.title }}</p>
            {% endif %}
          </a>
        {% endif %}
      {% endfor %}
    </section>
    {% endif %}

    <!-- HERO -->
    <section class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
      <h2 class="text-xl md:text-2xl font-bold">
        {% trans "All in one place" %}
      </h2>
      <p class="mt-2 text-sm md:text-base text-gray-600">
        {% trans "Immigration (GNIB), PPS, Leap Card, Driver‚Äôs Licence (NDLS) and more ‚Äî official links, step-by-step guides, phone numbers and addresses." %}
      </p>
      <p class="text-xs md:text-sm text-gray-500 mt-2">
        {% blocktrans %}Language: {{ locale }} | Country: {{ country }}{% endblocktrans %}
      </p>
    </section>

    <!-- LINKS √öTEIS -->
    <section id="uteis" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
      <h3 class="text-lg md:text-xl font-bold">{% trans "Useful links" %}</h3>
      <ul class="mt-4 grid gap-3">
        {% for r in useful_links %}
        <li class="p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition">
          <div class="flex items-center justify-between gap-3">
            <div class="min-w-0">
              <p class="font-medium text-sm md:text-base">
                {{ r.title }}
                {% if r.is_official %}
                  <span class="text-[10px] md:text-xs px-2 py-0.5 border rounded ml-2">
                    {% trans "Official" %}
                  </span>
                {% endif %}
              </p>
              {% if r.description %}
                <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
              {% endif %}
            </div>
            {% if r.url %}
              <a href="{{ r.url }}"
                 data-track="1"
                 data-link-id="{{ r.id }}"
                 data-href="{{ r.url }}"
                 class="shrink-0 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
                {% trans "Open" %}
              </a>
            {% endif %}
          </div>
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "No items yet." %}</p>
        {% endfor %}
      </ul>
    </section>

    <!-- COMO SOLICITAR -->
    <section id="como" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
      <h3 class="text-lg md:text-xl font-bold">{% trans "How and where to apply" %}</h3>
      <div class="mt-4 space-y-3 md:space-y-4">
        {% for r in how_to %}
        <article class="p-3 md:p-4 border rounded-lg">
          <h4 class="font-semibold text-sm md:text-base">{{ r.title }}</h4>
          {% if r.description %}
            <p class="text-xs md:text-sm text-gray-600 mt-1 whitespace-pre-line">
              {{ r.description }}
            </p>
          {% endif %}
          {% if r.url %}
            <a href="{{ r.url }}"
               data-track="1"
               data-link-id="{{ r.id }}"
               data-href="{{ r.url }}"
               class="mt-2 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
              {% trans "More details" %}
            </a>
          {% endif %}
        </article>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "No guides yet." %}</p>
        {% endfor %}
      </div>
    </section>

    <!-- TELEFONES -->
    <section id="telefones" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
      <h3 class="text-lg md:text-xl font-bold">{% trans "Phone numbers" %}</h3>
      <ul class="mt-3 grid gap-3 text-sm">
        {% for r in phones %}
        <li class="p-3 md:p-4 border rounded-lg">
          <p class="font-medium text-sm md:text-base">{{ r.title }}</p>
          {% if r.phone %}
            <a href="tel:{{ r.phone }}" class="text-xs md:text-sm text-blue-700 hover:underline block">
              {{ r.phone }}
            </a>
          {% endif %}
          {% if r.description %}
            <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
          {% endif %}
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "No phone numbers." %}</p>
        {% endfor %}
      </ul>
    </section>

    <!-- ENDERE√áOS -->
    <section id="enderecos" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
      <h3 class="text-lg md:text-xl font-bold">{% trans "Addresses" %}</h3>
      <ul class="mt-3 grid gap-3 text-sm">
        {% for r in addresses %}
        <li class="p-3 md:p-4 border rounded-lg">
          <p class="font-medium text-sm md:text-base">{{ r.title }}</p>
          {% if r.address %}
            <p class="text-xs md:text-sm mt-0.5">{{ r.address }}</p>
          {% endif %}
          {% if r.url %}
            <a href="{{ r.url }}"
               data-track="1"
               data-link-id="{{ r.id }}"
               data-href="{{ r.url }}"
               class="mt-1 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
              {% trans "Open on map" %}
            </a>
          {% endif %}
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "No addresses." %}</p>
        {% endfor %}
      </ul>
    </section>

    <!-- WHATSAPP (ACOMODA√á√ÉO) -->
    <section id="whatsapp" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
      <h3 class="text-lg md:text-xl font-bold">
        {% trans "WhatsApp groups (accommodation)" %}
      </h3>
      <p class="text-xs md:text-sm text-gray-500 mt-1">
        {% trans "Groups to find rooms, houses and accommodation in Ireland." %}
      </p>
      <ul class="mt-4 grid gap-3">
        {% for r in whatsapp_groups %}
        <li class="p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition">
          <div class="flex items-center justify-between gap-3">
            <div class="min-w-0">
              <p class="font-medium text-sm md:text-base">
                üí¨ {{ r.title }}
              </p>
              {% if r.description %}
                <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
              {% endif %}
            </div>
            {% if r.url %}
              <a href="{{ r.url }}"
                 data-track="1"
                 data-link-id="{{ r.id }}"
                 data-href="{{ r.url }}"
                 class="shrink-0 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
                {% trans "Join group" %}
              </a>
            {% endif %}
          </div>
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">
            {% trans "No groups yet." %}
          </p>
        {% endfor %}
      </ul>
    </section>

    <!-- EMPREGOS: SITES + FACEBOOK -->
    <section id="jobs" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm space-y-6">
      <h3 class="text-lg md:text-xl font-bold">
        {% trans "Jobs in Ireland" %}
      </h3>

      <!-- SITES DE EMPREGO -->
      <div>
        <h4 class="font-semibold text-sm md:text-base">
          {% trans "Job sites" %}
        </h4>
        <ul class="mt-3 grid gap-3">
          {% for r in job_sites %}
          <li class="p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition">
            <div class="flex items-center justify-between gap-3">
              <div class="min-w-0">
                <p class="font-medium text-sm md:text-base">{{ r.title }}</p>
                {% if r.description %}
                  <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
                {% endif %}
              </div>
              {% if r.url %}
                <a href="{{ r.url }}"
                   data-track="1"
                   data-link-id="{{ r.id }}"
                   data-href="{{ r.url }}"
                   class="shrink-0 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
                  {% trans "Visit site" %}
                </a>
              {% endif %}
            </div>
          </li>
          {% empty %}
            <p class="text-sm text-gray-500">
              {% trans "No job sites yet." %}
            </p>
          {% endfor %}
        </ul>
      </div>

      <!-- GRUPOS DE EMPREGO (FACEBOOK) -->
      <div>
        <h4 class="font-semibold text-sm md:text-base">
          {% trans "Job groups (Facebook)" %}
        </h4>
        <ul class="mt-3 grid gap-3">
          {% for r in job_facebook %}
          <li class="p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition">
            <div class="flex items-center justify-between gap-3">
              <div class="min-w-0">
                <p class="font-medium text-sm md:text-base">üìò {{ r.title }}</p>
                {% if r.description %}
                  <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
                {% endif %}
              </div>
              {% if r.url %}
                <a href="{{ r.url }}"
                   data-track="1"
                   data-link-id="{{ r.id }}"
                   data-href="{{ r.url }}"
                   class="shrink-0 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
                  {% trans "Open group" %}
                </a>
              {% endif %}
            </div>
          </li>
          {% empty %}
            <p class="text-sm text-gray-500">
              {% trans "No job groups yet." %}
            </p>
          {% endfor %}
        </ul>
      </div>
    </section>

    <!-- APPS E SERVI√áOS √öTEIS -->
    <section id="apps" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
      <h3 class="text-lg md:text-xl font-bold">
        {% trans "Useful apps and services" %}
      </h3>
      <p class="text-xs md:text-sm text-gray-500 mt-1">
        {% trans "Apps and services that make day-to-day life in Ireland easier." %}
      </p>
      <ul class="mt-4 grid gap-3">
        {% for r in daily_apps %}
        <li class="p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition">
          <div class="flex items-center justify-between gap-3">
            <div class="min-w-0">
              <p class="font-medium text-sm md:text-base">{{ r.title }}</p>
              {% if r.description %}
                <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
              {% endif %}
            </div>
            {% if r.url %}
              <a href="{{ r.url }}"
                 data-track="1"
                 data-link-id="{{ r.id }}"
                 data-href="{{ r.url }}"
                 class="shrink-0 inline-flex items-center px-3 py-1.5 border rounded-lg text-xs md:text-sm">
                {% trans "Open app/site" %}
              </a>
            {% endif %}
          </div>
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">
            {% trans "No apps yet." %}
          </p>
        {% endfor %}
      </ul>
    </section>

    <!-- V√çDEOS -->
    <section id="videos" class="bg-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-sm">
      <h3 class="text-lg md:text-xl font-bold">{% trans "Recommended videos" %}</h3>
      <div class="mt-3 grid gap-3 sm:grid-cols-2">
        {% for r in videos %}
        <a class="block p-3 md:p-4 border rounded-lg hover:bg-gray-50 transition"
           target="_blank" href="{{ r.url }}">
          <p class="font-medium text-sm md:text-base">{{ r.title }}</p>
          {% if r.description %}
            <p class="text-xs md:text-sm text-gray-600 mt-0.5">{{ r.description }}</p>
          {% endif %}
        </a>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "No videos." %}</p>
        {% endfor %}
      </div>
    </section>

  </main>

  {% if ads.footer %}
  <footer class="max-w-4xl mx-auto px-3 sm:px-4 py-8 text-sm text-gray-500">
    <div class="grid sm:grid-cols-2 gap-4">
      {% for ad in ads.footer %}
      <div class="p-3 md:p-4 border rounded-lg">
        {% if ad.html_embed %}
          {{ ad.html_embed|safe }}
        {% else %}
          <a target="_blank" href="{{ ad.target_url }}">
            {% if ad.image_url %}
              <img src="{{ ad.image_url }}" alt="{{ ad.title }}" class="rounded mb-2 w-full">
            {% endif %}
            {% if ad.title %}
              <p>{{ ad.title }}</p>
            {% endif %}
          </a>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </footer>
  {% endif %}

  <p class="max-w-4xl mx-auto px-3 sm:px-4 pb-6 text-[11px] md:text-xs text-gray-500 text-center">
    {% trans "Made with ‚ù§Ô∏è for the immigrant community in Ireland." %}
  </p>

  <!-- TRACKING DE CLIQUES -->
  <script>
    document.addEventListener("click", async (e) => {
      const a = e.target.closest('a[data-track="1"]');
      if (!a) return;
      e.preventDefault();
      const linkId = a.getAttribute("data-link-id");
      const href = a.getAttribute("data-href");
      const locale = "{{ locale }}";
      const country = "{{ country }}";
      try {
        await fetch(`/track/click/${linkId}/`, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ locale, country })
        });
      } catch (err) {
        console.warn("tracking falhou", err);
      }
      window.open(href, "_blank");
    });
  </script>

  <!-- LOCALE AUTOM√ÅTICO (sem bot√£o Go) -->
  <script>
    const localeSelect = document.getElementById("locale");
    if (localeSelect) {
      localeSelect.addEventListener("change", () => {
        const loc = localeSelect.value || "pt-br";
        window.location.href = `/${loc}/IE/`;
      });
    }
  </script>

  <!-- MENU MOBILE JS -->
  <script>
    const mobileMenuBtn = document.getElementById("mobileMenuBtn");
    const mobileMenu    = document.getElementById("mobileMenu");
    const mobileClose   = document.getElementById("mobileMenuClose");
    const mobileOverlay = document.getElementById("mobileMenuOverlay");

    function closeMobileMenu() {
      mobileMenu.classList.add("hidden");
    }
    function openMobileMenu() {
      mobileMenu.classList.remove("hidden");
    }

    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener("click", () => {
        if (mobileMenu.classList.contains("hidden")) {
          openMobileMenu();
        } else {
          closeMobileMenu();
        }
      });
    }
    if (mobileClose) {
      mobileClose.addEventListener("click", closeMobileMenu);
    }
    if (mobileOverlay) {
      mobileOverlay.addEventListener("click", closeMobileMenu);
    }

    // fecha menu ao clicar em qualquer link do pr√≥prio menu
    document.querySelectorAll("[data-mobile-nav-link]").forEach((el) => {
      el.addEventListener("click", closeMobileMenu);
    });
  </script>
</body>
</html>
