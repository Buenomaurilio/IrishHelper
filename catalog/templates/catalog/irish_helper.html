{% load static %}
{% load i18n %}
<!doctype html>
<html lang="{{ locale }}">
<head>
  <meta charset="utf-8">
  <title>{% trans "IrishHelper ‚Äî Guia para imigrantes na Irlanda" %} ‚Äî {{ locale|upper }} / {{ country }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>

  <header class="sticky top-0 bg-white/80 backdrop-blur border-b">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">

    <!-- ‚¨ÖÔ∏è Idioma + Bot√£o (mesma linha) -->
    <div class="flex items-center gap-2">
      <select id="locale" class="border rounded px-2 py-1 text-sm">
        <option value="pt-br" {% if locale == "pt-br" %}selected{% endif %}>Portugu√™s</option>
        <option value="en"    {% if locale == "en" %}selected{% endif %}>English</option>
        <option value="es"    {% if locale == "es" %}selected{% endif %}>Espa√±ol</option>
      </select>

      <button type="button" id="goLC" class="border px-3 py-1 rounded text-sm">
        {% trans "Ir" %}
      </button>
    </div>

    <!-- üü¢ T√≠tulo centralizado -->
    <div class="flex-1 flex items-center justify-center gap-2">
      <span class="text-lg">üáÆüá™</span>
      <h1 class="text-xl font-semibold text-center whitespace-nowrap">
        {% trans "IrishHelper ‚Äî Guia R√°pido da Irlanda" %}
      </h1>
    </div>

    <!-- Menu ‚û°Ô∏è no lado direito -->
    <nav class="hidden sm:flex text-sm space-x-4 whitespace-nowrap">
      <a href="#uteis" class="hover:underline">{% trans "Links √∫teis" %}</a>
      <a href="#como" class="hover:underline">{% trans "Como solicitar" %}</a>
      <a href="#telefones" class="hover:underline">{% trans "Telefones" %}</a>
      <a href="#enderecos" class="hover:underline">{% trans "Endere√ßos" %}</a>
      <a href="#videos" class="hover:underline">{% trans "V√≠deos" %}</a>
    </nav>

  </div>
</header>


  <main class="max-w-4xl mx-auto px-4 py-8 space-y-10">
    {% if ads.hero %}
    <section class="bg-white p-6 rounded-2xl shadow">
      {% for ad in ads.hero %}
        {% if ad.html_embed %}
          <div class="mb-4">{{ ad.html_embed|safe }}</div>
        {% else %}
          <a target="_blank" href="{{ ad.target_url }}" class="block">
            {% if ad.image_url %}<img src="{{ ad.image_url }}" alt="{{ ad.title }}" class="rounded mb-2">{% endif %}
            {% if ad.title %}<p class="text-sm text-gray-600">{{ ad.title }}</p>{% endif %}
          </a>
        {% endif %}
      {% endfor %}
    </section>
    {% endif %}

    <section class="bg-white p-6 rounded-2xl shadow">
      <h2 class="text-2xl font-bold">
        {% trans "Tudo em um s√≥ lugar" %}
      </h2>
      <p class="mt-2 text-gray-600">
        {% trans "Imigra√ß√£o (GNIB), PPS, Leap Card, Carteira de motorista (NDLS) e mais ‚Äî links oficiais, passo a passo, telefones e endere√ßos." %}
      </p>
      {% comment %} <p class="text-sm text-gray-500 mt-2">
        {% blocktrans %}Idioma: {{ locale }} | Pa√≠s: {{ country }}{% endblocktrans %}
      </p> {% endcomment %}
    </section>

    <section id="uteis" class="bg-white p-6 rounded-2xl shadow">
      <h3 class="text-xl font-bold">{% trans "Links √∫teis" %}</h3>
      <ul class="mt-4 grid gap-3">
        {% for r in useful_links %}
        <li class="p-4 border rounded-lg hover:bg-gray-50">
          <div class="flex items-center justify-between">
            <div>
              <p class="font-medium">
                {{ r.title }}
                {% if r.is_official %}
                  <span class="text-xs px-2 py-0.5 border rounded ml-2">
                    {% trans "Oficial" %}
                  </span>
                {% endif %}
              </p>
              {% if r.description %}
                <p class="text-sm text-gray-600">{{ r.description }}</p>
              {% endif %}
            </div>
            {% if r.url %}
              <a href="{{ r.url }}"
                 data-track="1"
                 data-link-id="{{ r.id }}"
                 data-href="{{ r.url }}"
                 class="inline-flex items-center px-3 py-1.5 border rounded-lg text-sm">
                {% trans "Acessar" %}
              </a>
            {% endif %}
          </div>
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "Sem itens ainda." %}</p>
        {% endfor %}
      </ul>
    </section>

    <section id="como" class="bg-white p-6 rounded-2xl shadow">
      <h3 class="text-xl font-bold">{% trans "Como e onde solicitar" %}</h3>
      <div class="mt-4 space-y-4">
        {% for r in how_to %}
        <article class="p-4 border rounded-lg">
          <h4 class="font-semibold">{{ r.title }}</h4>
          {% if r.description %}
            <p class="text-sm text-gray-600 mt-1 whitespace-pre-line">{{ r.description }}</p>
          {% endif %}
          {% if r.url %}
            <a href="{{ r.url }}"
               data-track="1"
               data-link-id="{{ r.id }}"
               data-href="{{ r.url }}"
               class="inline-flex items-center px-3 py-1.5 border rounded-lg text-sm">
              {% trans "Mais detalhes" %}
            </a>
          {% endif %}
        </article>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "Sem guias ainda." %}</p>
        {% endfor %}
      </div>
    </section>

    <section id="telefones" class="bg-white p-6 rounded-2xl shadow">
      <h3 class="text-xl font-bold">{% trans "Telefones √∫teis" %}</h3>
      <ul class="mt-3 grid sm:grid-cols-2 gap-3 text-sm">
        {% for r in phones %}
        <li class="p-4 border rounded-lg">
          <p class="font-medium">{{ r.title }}</p>
          {% if r.phone %}
            <a href="tel:{{ r.phone }}" class="text-blue-700 hover:underline">{{ r.phone }}</a>
          {% endif %}
          {% if r.description %}
            <p class="text-gray-600">{{ r.description }}</p>
          {% endif %}
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "Sem telefones." %}</p>
        {% endfor %}
      </ul>
    </section>

    <section id="enderecos" class="bg-white p-6 rounded-2xl shadow">
      <h3 class="text-xl font-bold">{% trans "Endere√ßos" %}</h3>
      <ul class="mt-3 grid gap-3 text-sm">
        {% for r in addresses %}
        <li class="p-4 border rounded-lg">
          <p class="font-medium">{{ r.title }}</p>
          {% if r.address %}<p>{{ r.address }}</p>{% endif %}
          {% if r.url %}
            <a href="{{ r.url }}"
               data-track="1"
               data-link-id="{{ r.id }}"
               data-href="{{ r.url }}"
               class="inline-flex items-center px-3 py-1.5 border rounded-lg text-sm">
              {% trans "Abrir no mapa" %}
            </a>
          {% endif %}
        </li>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "Sem endere√ßos." %}</p>
        {% endfor %}
      </ul>
    </section>

    <section id="videos" class="bg-white p-6 rounded-2xl shadow">
      <h3 class="text-xl font-bold">{% trans "V√≠deos recomendados" %}</h3>
      <div class="mt-3 grid sm:grid-cols-2 gap-4">
        {% for r in videos %}
        <a class="block p-4 border rounded-lg hover:bg-gray-50" target="_blank" href="{{ r.url }}">
          <p class="font-medium">{{ r.title }}</p>
          {% if r.description %}
            <p class="text-sm text-gray-600">{{ r.description }}</p>
          {% endif %}
        </a>
        {% empty %}
          <p class="text-sm text-gray-500">{% trans "Sem v√≠deos." %}</p>
        {% endfor %}
      </div>
    </section>
  </main>

  {% if ads.footer %}
  <footer class="max-w-4xl mx-auto px-4 py-10 text-sm text-gray-500">
    <div class="grid sm:grid-cols-2 gap-4">
      {% for ad in ads.footer %}
      <div class="p-4 border rounded-lg">
        {% if ad.html_embed %}
          {{ ad.html_embed|safe }}
        {% else %}
          <a target="_blank" href="{{ ad.target_url }}">
            {% if ad.image_url %}<img src="{{ ad.image_url }}" alt="{{ ad.title }}" class="rounded mb-2">{% endif %}
            {% if ad.title %}<p>{{ ad.title }}</p>{% endif %}
          </a>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </footer>
  {% endif %}

  <p class="max-w-4xl mx-auto px-4 pb-6 text-xs text-gray-500">
    {% trans "Feito com ‚ù§Ô∏è para a comunidade de imigrantes na Irlanda." %}
  </p>

  <script>
    document.addEventListener("click", async (e) => {
      const a = e.target.closest('a[data-track="1"]');
      if (!a) return;
      e.preventDefault();
      const linkId = a.getAttribute("data-link-id");
      const href = a.getAttribute("data-href");
      const locale = "{{ locale }}";
      const country = "{{ country }}";
      try {
        await fetch(`/track/click/${linkId}/`, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ locale, country })
        });
      } catch (err) {
        console.warn("tracking falhou", err);
      }
      window.open(href, "_blank");
    });
  </script>
  <script>
    document.getElementById("goLC").addEventListener("click", () => {
      const loc = document.getElementById("locale").value;
      const url = `/${loc}/IE/`;  // pa√≠s fixo: Irlanda
      window.location.href = url;
    });
  </script>
</body>
</html>
